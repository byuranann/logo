import React, { useState } from ‘react’;
import { Upload, Wand2, Download, Loader2 } from ‘lucide-react’;

export default function LogoGenerator() {
const [selectedImage, setSelectedImage] = useState(null);
const [imagePreview, setImagePreview] = useState(null);
const [prompt, setPrompt] = useState(’’);
const [imageCount, setImageCount] = useState(1);
const [generatedLogos, setGeneratedLogos] = useState([]);
const [isGenerating, setIsGenerating] = useState(false);
const [apiKey, setApiKey] = useState(’’);
const [showApiInput, setShowApiInput] = useState(true);

const handleImageSelect = (e) => {
const file = e.target.files[0];
if (file) {
setSelectedImage(file);
const reader = new FileReader();
reader.onloadend = () => {
setImagePreview(reader.result);
};
reader.readAsDataURL(file);
}
};

const generateLogos = async () => {
if (!selectedImage || !prompt || !apiKey) {
alert(‘กรุณาเลือกรูปภาพ ใส่ prompt และ API Key’);
return;
}

```
setIsGenerating(true);
setGeneratedLogos([]);

try {
  const reader = new FileReader();
  reader.onloadend = async () => {
    const base64Image = reader.result.split(',')[1];
    
    const logos = [];
    for (let i = 0; i < imageCount; i++) {
      try {
        const response = await fetch(
          `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash-exp:generateContent?key=${apiKey}`,
          {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({
              contents: [{
                parts: [
                  {
                    text: `สร้างโลโก้ตามคำอธิบายนี้: ${prompt}. โปรดสร้างโลโก้ที่มีความเป็นมืออาชีพ สวยงาม และเหมาะสำหรับการใช้งานจริง โดยอิงจากรูปภาพที่ให้มา`
                  },
                  {
                    inline_data: {
                      mime_type: selectedImage.type,
                      data: base64Image
                    }
                  }
                ]
              }],
              generationConfig: {
                temperature: 0.9,
                topK: 40,
                topP: 0.95,
                maxOutputTokens: 1000,
              }
            })
          }
        );

        const data = await response.json();
        
        if (data.candidates && data.candidates[0]) {
          logos.push({
            id: i,
            description: data.candidates[0].content.parts[0].text,
            placeholder: true
          });
        }
      } catch (error) {
        console.error(`Error generating logo ${i + 1}:`, error);
      }
    }
    
    setGeneratedLogos(logos);
  };
  
  reader.readAsDataURL(selectedImage);
} catch (error) {
  console.error('Error:', error);
  alert('เกิดข้อผิดพลาดในการสร้างโลโก้');
} finally {
  setIsGenerating(false);
}
```

};

const downloadLogo = (logo) => {
const canvas = document.createElement(‘canvas’);
canvas.width = 512;
canvas.height = 512;
const ctx = canvas.getContext(‘2d’);

```
const gradient = ctx.createLinearGradient(0, 0, 512, 512);
gradient.addColorStop(0, '#667eea');
gradient.addColorStop(1, '#764ba2');
ctx.fillStyle = gradient;
ctx.fillRect(0, 0, 512, 512);

ctx.fillStyle = 'white';
ctx.font = 'bold 48px Arial';
ctx.textAlign = 'center';
ctx.fillText('LOGO', 256, 256);

canvas.toBlob((blob) => {
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = `logo-${logo.id + 1}.png`;
  a.click();
  URL.revokeObjectURL(url);
});
```

};

return (
<div className="min-h-screen bg-gradient-to-br from-purple-50 via-white to-blue-50">
<div className="container mx-auto px-4 py-8">
<header className="text-center mb-12">
<h1 className="text-5xl font-bold bg-gradient-to-r from-purple-600 to-blue-600 bg-clip-text text-transparent mb-3">
AI Logo Generator
</h1>
<p className="text-gray-600 text-lg">สร้างโลโก้สวยงามด้วย Google AI Studio</p>
</header>

```
    <div className="grid lg:grid-cols-2 gap-8 max-w-7xl mx-auto">
      {/* Control Panel */}
      <div className="bg-white rounded-2xl shadow-xl p-8 space-y-6">
        <h2 className="text-2xl font-bold text-gray-800 mb-6">ส่วนควบคุม</h2>
        
        {showApiInput && (
          <div className="bg-blue-50 border border-blue-200 rounded-xl p-4 mb-6">
            <label className="block text-sm font-semibold text-gray-700 mb-2">
              Google AI Studio API Key
            </label>
            <input
              type="password"
              value={apiKey}
              onChange={(e) => setApiKey(e.target.value)}
              placeholder="ใส่ API Key ของคุณ"
              className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
            />
            <p className="text-xs text-gray-600 mt-2">
              รับ API Key ได้ที่: <a href="https://aistudio.google.com/app/apikey" target="_blank" className="text-blue-600 underline">Google AI Studio</a>
            </p>
          </div>
        )}

        {/* Image Upload */}
        <div>
          <label className="block text-sm font-semibold text-gray-700 mb-3">
            <Upload className="inline-block w-4 h-4 mr-2" />
            เลือกรูปภาพต้นแบบ
          </label>
          <div className="relative">
            <input
              type="file"
              accept="image/*"
              onChange={handleImageSelect}
              className="hidden"
              id="imageUpload"
            />
            <label
              htmlFor="imageUpload"
              className="flex items-center justify-center w-full h-48 border-2 border-dashed border-gray-300 rounded-xl cursor-pointer hover:border-purple-500 transition-all bg-gray-50 hover:bg-purple-50"
            >
              {imagePreview ? (
                <img src={imagePreview} alt="Preview" className="h-full object-contain rounded-lg" />
              ) : (
                <div className="text-center">
                  <Upload className="w-12 h-12 mx-auto text-gray-400 mb-2" />
                  <p className="text-gray-500">คลิกเพื่อเลือกรูปภาพ</p>
                </div>
              )}
            </label>
          </div>
        </div>

        {/* Prompt Input */}
        <div>
          <label className="block text-sm font-semibold text-gray-700 mb-3">
            คำอธิบายโลโก้ (Prompt)
          </label>
          <textarea
            value={prompt}
            onChange={(e) => setPrompt(e.target.value)}
            placeholder="เช่น: โลโก้สำหรับร้านกาแฟ สไตล์มินิมอล สีน้ำตาล ดูอบอุ่น..."
            className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent resize-none"
            rows="4"
          />
        </div>

        {/* Image Count */}
        <div>
          <label className="block text-sm font-semibold text-gray-700 mb-3">
            จำนวนโลโก้ที่ต้องการสร้าง
          </label>
          <div className="flex gap-3">
            {[1, 2, 4].map((count) => (
              <button
                key={count}
                onClick={() => setImageCount(count)}
                className={`flex-1 py-3 rounded-lg font-semibold transition-all ${
                  imageCount === count
                    ? 'bg-gradient-to-r from-purple-600 to-blue-600 text-white shadow-lg'
                    : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
                }`}
              >
                {count} รูป
              </button>
            ))}
          </div>
        </div>

        {/* Generate Button */}
        <button
          onClick={generateLogos}
          disabled={isGenerating}
          className="w-full bg-gradient-to-r from-purple-600 to-blue-600 text-white py-4 rounded-xl font-bold text-lg hover:shadow-2xl transition-all transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none"
        >
          {isGenerating ? (
            <span className="flex items-center justify-center">
              <Loader2 className="w-6 h-6 mr-2 animate-spin" />
              กำลังสร้างโลโก้...
            </span>
          ) : (
            <span className="flex items-center justify-center">
              <Wand2 className="w-6 h-6 mr-2" />
              สร้างโลโก้
            </span>
          )}
        </button>
      </div>

      {/* Results Panel */}
      <div className="bg-white rounded-2xl shadow-xl p-8">
        <h2 className="text-2xl font-bold text-gray-800 mb-6">ผลลัพธ์</h2>
        
        {generatedLogos.length === 0 && !isGenerating ? (
          <div className="flex items-center justify-center h-96 border-2 border-dashed border-gray-200 rounded-xl">
            <div className="text-center text-gray-400">
              <Wand2 className="w-16 h-16 mx-auto mb-4" />
              <p className="text-lg">โลโก้ที่สร้างจะแสดงที่นี่</p>
            </div>
          </div>
        ) : (
          <div className={`grid ${imageCount === 1 ? 'grid-cols-1' : imageCount === 2 ? 'grid-cols-2' : 'grid-cols-2'} gap-4`}>
            {generatedLogos.map((logo) => (
              <div
                key={logo.id}
                className="relative group aspect-square bg-gradient-to-br from-purple-100 to-blue-100 rounded-xl overflow-hidden shadow-lg hover:shadow-2xl transition-all"
              >
                <div className="absolute inset-0 flex items-center justify-center p-4">
                  <div className="text-center">
                    <div className="w-32 h-32 mx-auto mb-4 bg-gradient-to-br from-purple-500 to-blue-500 rounded-full flex items-center justify-center">
                      <span className="text-white text-4xl font-bold">LOGO</span>
                    </div>
                    <p className="text-sm text-gray-600 line-clamp-3">{logo.description}</p>
                  </div>
                </div>
                
                <button
                  onClick={() => downloadLogo(logo)}
                  className="absolute bottom-4 right-4 bg-white text-purple-600 p-3 rounded-full shadow-lg opacity-0 group-hover:opacity-100 transition-all transform hover:scale-110"
                >
                  <Download className="w-5 h-5" />
                </button>
              </div>
            ))}
          </div>
        )}

        {isGenerating && (
          <div className="flex items-center justify-center h-96">
            <div className="text-center">
              <Loader2 className="w-16 h-16 mx-auto mb-4 animate-spin text-purple-600" />
              <p className="text-lg text-gray-600">กำลังสร้างโลโก้...</p>
            </div>
          </div>
        )}
      </div>
    </div>
  </div>
</div>
```

);
}
